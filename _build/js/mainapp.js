!function(){function e(e,o,t,n){o.html5Mode(!1),e.when("/",{templateUrl:"views/login.html",controller:"LoginController",controllerAs:"login"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterController",controllerAs:"register"}).when("/manage-profile",{templateUrl:"views/profile.html",controller:"ManageProfileController",controllerAs:"manage_profile"}).otherwise({redirectTo:"/"}),t.interceptors.push("authInterceptor"),n.aHrefSanitizationWhitelist(/^\s*(https?|file|ftp|blob):|data:image\//)}function o(e,o,t,n){return{request:function(e){return e.headers=e.headers||{},e},responseError:function(e){return 404===e.status?(n.path("/"),o.reject(e)):o.reject(e)}}}function t(e,o){!function(e,o,t){var n,r=e.getElementsByTagName(o)[0];e.getElementById(t)||(n=e.createElement(o),n.id=t,n.src="//connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(n,r))}(document,"script","facebook-jssdk")}angular.module("ConnectifyWeb",["ngRoute","angular-md5"]).config(e),e.$inject=["$routeProvider","$locationProvider","$httpProvider","$compileProvider"],angular.module("ConnectifyWeb").factory("authInterceptor",o),o.$inject=["$rootScope","$q","LocalStorage","$location"],angular.module("ConnectifyWeb").filter("to_trusted",["$sce",function(e){return function(o){return e.trustAsHtml(o)}}]),angular.module("ConnectifyWeb").run(t),t.$inject=["$rootScope","$location"]}(),function(){angular.module("ConnectifyWeb").constant("CONSTANTS",{API_URL:"http://192.168.56.101:3000/connectifyapi/"})}(),function(){function e(e,o,t){var n=this;return n.getUserInfo=function(){var e=t.defer();return FB.api("/me",function(o){!o||o.error?e.reject("Error occured"):e.resolve(o)}),e.promise},n.watchLoginChange=function(){FB.Event.subscribe("auth.authResponseChange",function(t){"connected"===t.status?(console.log("User is connected."),o.path("/manage-profile").replace(),e.$apply()):(o.path("/login").replace(),e.$apply())})},n.logout=function(){FB.logout(function(o){e.$apply(function(){e.user={}})})},n}angular.module("ConnectifyWeb").factory("FacebookService",e),e.$inject=["$rootScope","$location","$q"]}(),function(){function e(e,o){var t=this,n=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var o=16*Math.random()|0,t="x"==e?o:3&o|8;return t.toString(16)})},r=null,i=0,a=null;e.exists()?(r=e.get("visitor_id"),i=e.get("visit_count"),a=e.get("user_rating"),r?(e.update("visit_count",++i),navigator.geolocation.getCurrentPosition(function(o){e.update("latitude",o.coords.latitude),e.update("longitude",o.coords.longitude)})):(e.set("visitor_id",n()),e.set("visit_count",1),navigator.geolocation.getCurrentPosition(function(o){e.set("latitude",o.coords.latitude),e.set("longitude",o.coords.longitude)}))):(r=Cookies.get("visitor_id"),i=Cookies.get("visit_count"),a=Cookies.get("user_rating"),r||Cookies.set("visitor_id",n(),{expires:365}),Cookies.set("visit_count",++i,{expires:365}),navigator.geolocation.getCurrentPosition(function(e){Cookies.set("latitude",e.coords.latitude,{expires:365}),Cookies.set("longitude",e.coords.longitude,{expires:365})})),o.query("GET","hello",{},{}).then(function(e){t.ovocie=e.data,console.log("Hello response: ",t.ovocie)})}function o(e,o,t,n,r,i,a){t.user={phoneNumber:"",password:""},t.login=function(){var e=t.user.phoneNumber,n=t.user.password,c=a.createHash(e+"_"+n);i.query("POST","authenticate",{},{salt:c}).then(function(e){self.ovocie=e.data;var t=self.ovocie.result;"ok"==t?(console.log("You have been logged in !"),r.path("/manage-profile").replace(),o.$apply()):console.log("Oops ! Your credentials are incorrect. Please try again...")})},o.user={},n.fbAsyncInit=function(){FB.init({appId:"1628447944135801",status:!0,cookie:!0,xfbml:!0,version:"v2.6"}),e.watchLoginChange(),r.path("/manage-profile").replace(),o.$apply()}}function t(e,o,t,n){o.passwordError="",o.user={password:"",passwordConfirm:""},o.canRegister="",o.checkMatch=function(){o.user.password!=o.user.passwordConfirm?o.passwordError="Passwords don't match...":(o.passwordError="Passwords match !",e.userVerified?o.canRegister="checked":(o.canRegister="",e.verifiedStatus="Your phone number has not been verified. Please click 'Send Code' to send verification code your number !"))},o.registerUser=function(){var t=e.fullNumber,r=o.user.password;n.query("POST","register",{},{phoneNumber:t,password:r}).then(function(e){self.ovocie=e.data;var t=self.ovocie.result;"ok"==t?o.registrationStatus="You have been registered !":o.registrationStatus="Oops ! We were not able to register you. Please try again..."})}}function n(e,o){}function r(e,o,t,n){var r=angular.element("#browse-avatar");e.getDialog=function(){o(function(){r.trigger("click")},100)},e.file={},e.$on("fileSelected",function(o,t){e.$apply(function(){e.file=t.file})}),e.submit=function(){n({method:"POST",url:t.API_URL+"upload-avatar",headers:{"Content-Type":!1},transformRequest:function(e){var o=new FormData;return o.append("file",e.file),o},data:{file:e.file}}).success(function(e,o,t,n){console.log("success!")}).error(function(e,o,t,n){console.log("failed!")})}}angular.module("ConnectifyWeb").controller("MainController",e),e.$inject=["LocalStorage","QueryService"],angular.module("ConnectifyWeb").controller("LoginController",o),o.$inject=["FacebookService","$rootScope","$scope","$window","$location","QueryService","md5"],angular.module("ConnectifyWeb").controller("RegisterController",t),t.$inject=["$rootScope","$scope","$window","QueryService"],angular.module("ConnectifyWeb").controller("ManageProfileController",n),n.$inject=["$rootScope","$scope"],angular.module("ConnectifyWeb").controller("UploadController",r),r.$inject=["$scope","$timeout","CONSTANTS","$http"]}();
!function(){function e(e,o,t,r,n){o.html5Mode(!1),e.when("/",{templateUrl:"views/login.html",controller:"LoginController",controllerAs:"login"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterController",controllerAs:"register"}).when("/manage-profile",{templateUrl:"views/profile.html",controller:"ManageProfileController",controllerAs:"manage_profile"}).when("/invite-friends",{templateUrl:"views/invite-friends.html",controller:"InviteFriendsController",controllerAs:"invite_friends"}).when("/home",{templateUrl:"views/home.html",controller:"HomeController",controllerAs:"home"}).otherwise({redirectTo:"/"}),t.interceptors.push("authInterceptor"),r.aHrefSanitizationWhitelist(/^\s*(https?|file|ftp|blob):|data:image\//),n.decorator("$exceptionHandler",["$delegate",function(e){return function(o,t){e(o,t);var r="",n="";r+='Exception: "'+o.toString()+'"\n',r+="Caused by: "+t+"\n",n+=o.message?"Message: "+o.message+"\n":"",n+=o.fileName?"File Name: "+o.fileName+"\n":"",n+=o.lineNumber?"Line Number: "+o.lineNumber+"\n":"",n+=o.stack?"Stack Trace: "+o.stack+"\n":"",n&&(r+=n),console.log(r)}}])}function o(e,o,t,r){return{request:function(e){return e.headers=e.headers||{},e},responseError:function(e){return 404===e.status?(r.path("/"),o.reject(e)):o.reject(e)}}}function t(e,o){var t={nextRoute:function(){var t=e.user_info,r="";return 1==t.isRegistered?0==t.hasManagedProfile?r="/manage-profile":1==t.hasManagedProfile&&(r=0==t.hasInvitedFriends?"/invite-friends":"/home"):r=1==t.isLogged?"/home":"/",o.path(r).replace(),this}};return t}function r(e,o){e.user_info={isLogged:0,isRegistered:0,hasManagedProfile:0,hasInvitedFriends:0,atHome:0},function(e,o,t){var r,n=e.getElementsByTagName(o)[0];e.getElementById(t)||(r=e.createElement(o),r.id=t,r.src="//connect.facebook.net/en_US/sdk.js",n.parentNode.insertBefore(r,n))}(document,"script","facebook-jssdk")}angular.module("ConnectifyWeb",["ngRoute","angular-md5","flow"]).config(e),e.$inject=["$routeProvider","$locationProvider","$httpProvider","$compileProvider","$provide"],angular.module("ConnectifyWeb").factory("authInterceptor",o),o.$inject=["$rootScope","$q","LocalStorage","$location"],angular.module("ConnectifyWeb").filter("to_trusted",["$sce",function(e){return function(o){return e.trustAsHtml(o)}}]),angular.module("ConnectifyWeb").factory("RouteManager",t),t.$inject=["$rootScope","$location"],angular.module("ConnectifyWeb").run(r),r.$inject=["$rootScope","$location"]}(),function(){angular.module("ConnectifyWeb").constant("CONSTANTS",{API_URL:"http://192.168.56.101:3000/connectifyapi/"})}(),function(){function e(e,o,t,r,n,i){var s=this;return s.getUserInfo=function(){var e=i.defer();return FB.api("/me",function(o){!o||o.error?e.reject("Error occured"):(console.log("FB logged in: ",o),e.resolve(o))}),e.promise},s.watchLoginChange=function(){FB.Event.subscribe("auth.authResponseChange",function(e){if("connected"===e.status){console.log("User is connected."),console.log("FB connected: ",e);e.authResponse.userID;o.path("/manage-profile").replace()}else o.path("/login").replace(),s.logout()})},s.logout=function(){FB.logout()},s}angular.module("ConnectifyWeb").factory("FacebookService",e),e.$inject=["$rootScope","$location","Session","QueryService","md5","$q"]}(),function(){function e(e,o,t,r,n,i,s,a){r.user={phoneNumber:"",password:""},r.login=function(){var e=(t.visitor_id,r.user.phoneNumber),o=r.user.password,n=s.createHash(e+"_"+o);i.query("POST","authenticate",{},{salt:n}).then(function(e){self.ovocie=e.data;var o=self.ovocie.result;"valid"==o?(console.log("You have been logged in !"),t.user_info.isRegistered=1,t.user_info.isLogged=1,RouteManager.nextRoute()):console.log("Oops ! Your credentials are incorrect. Please try again...")})},o.fbAsyncInit=function(){FB.init({appId:"1628447944135801",status:!0,cookie:!0,xfbml:!0,version:"v2.6"}),e.watchLoginChange()}}function o(e,o,t,n,i){var s=r(n);e.visitor_id=s.visitor_id,o.passwordError="",o.user={password:"",passwordConfirm:""},o.canRegister="",o.checkMatch=function(){o.user.password!=o.user.passwordConfirm?o.passwordError="Passwords don't match...":(o.passwordError="Passwords match !",e.userVerified?o.canRegister="checked":(o.canRegister="",e.verifiedStatus="Your phone number has not been verified. Please click 'Send Code' to send verification code your number !"))},o.registerUser=function(){var r=e.visitor_id,n=e.fullNumber,s=o.user.password;t.query("POST","register",{},{visitor_id:r,phoneNumber:n,password:s}).then(function(t){var r=t.data;"ok"==r.result?(e.user_info.isRegistered=1,i.nextRoute()):o.registrationStatus="Oops ! We were not able to register you. Please try again..."})}}function t(e,o,t,r){var n=(e.session,null),i=r.API_URL+"upload-avatar?salt="+n;e.user_info.isRegistered=1,e.user_info.isLogged=1,e.user_info.hasManagedProfile=1,o.config={singleFile:!0,target:i,testChunks:!1};var s=angular.element("#profile-picture");o.$on("flow::fileAdded",function(e,o,t){s.removeClass("profile-pic-default"),s.addClass("profile-pic")}),o.$on("flow::fileRemoved",function(e,o,t){s.removeClass("profile-pic"),s.addClass("profile-pic-default")})}angular.module("ConnectifyWeb").controller("LoginController",e),e.$inject=["FacebookService","$window","$rootScope","$scope","$location","QueryService","md5","Session"];var r=function(e){var o=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var o=16*Math.random()|0,t="x"==e?o:3&o|8;return t.toString(16)}).replace('"',"")},t=null,r=0;return e.exists()?(t=e.get("visitor_id"),r=e.get("visit_count"),t?(e.update("visit_count",++r),navigator.geolocation.getCurrentPosition(function(o){e.update("latitude",o.coords.latitude),e.update("longitude",o.coords.longitude)})):(e.set("visitor_id",o()),e.set("visit_count",1),navigator.geolocation.getCurrentPosition(function(o){e.set("latitude",o.coords.latitude),e.set("longitude",o.coords.longitude)}))):(t=Cookies.get("visitor_id"),r=Cookies.get("visit_count"),t||Cookies.set("visitor_id",o(),{expires:365}),Cookies.set("visit_count",++r,{expires:365}),navigator.geolocation.getCurrentPosition(function(e){Cookies.set("latitude",e.coords.latitude,{expires:365}),Cookies.set("longitude",e.coords.longitude,{expires:365})})),{visitor_id:t,visit_count:r}};angular.module("ConnectifyWeb").controller("RegisterController",o),o.$inject=["$rootScope","$scope","QueryService","LocalStorage","RouteManager"],angular.module("ConnectifyWeb").controller("ManageProfileController",t),t.$inject=["$rootScope","$scope","Session","CONSTANTS"]}();